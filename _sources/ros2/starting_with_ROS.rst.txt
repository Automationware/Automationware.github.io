.. _start-with-ros-on-the-robot:

Starting with ROS on the Robot
==============================

Connecting your PC to the platform via the middleware
-----------------------------------------------------

By default, all distributions of ROS 2 use Fast-RTPS as the middleware. We will continue to support the default middleware and will make the changes according to the developments of Open Robotics.

Connecting to the PC and the robot has already been discussed in :ref:`getting-started`.

ROS 2 in general uses the Domain ID to distinguish between groups of computers running on the same network. By default, we set all the domain IDs of our robots to ``0``, which is also the factory default configuration of ROS 2. 

If changes are required, then the user has to add the following line to the ``~/.bashrc`` of his client PC as well as the robot PC.

::

	export ROS_DOMAIN_ID=1

.. note:: The above setting will only work for devices connected to the same network, i.e. technically having the same subnet mask. 

.. note:: More `about ROS Middleware found here <https://docs.ros.org/en/humble/Concepts/About-Different-Middleware-Vendors.html>`_ and `about ROS Domain ID can be found here <https://docs.ros.org/en/rolling/Concepts/About-Domain-ID.html>`_. 

Testing your connection
-----------------------

In general, when you turn on your new robot, there is an autostart script for ROS that would bring up all the necessary drivers and packages for the hardware components as part of the robot. If you followed the automated workspace setup instructions in :ref:`installation`, then the autostart script would already be part of the robot's desktop.

After completing the ROS network configuration your PC should be able to connect to the ROS on the platform. To check the connection you can try to list the available topics:

.. note:: If you are changing the relayboard configs, it is always essential to turn the key towards the "on" direction, once after the ROS bringup as been initiated. The indications can be seen with the LED's if they are present. The robot will not move without the key being turned.

::

    ros2 topic list

It should show the topics as follows:

::

	/cmd_vel
	/diagnostics
	/drives/joint_states
	/drives/joint_states_raw
	/drives/joint_trajectory
	/joint_states
	/joy
	/joy/set_feedback
	/lidar_1/scan
	/lidar_1/scan_filtered
	/lidar_2/scan
	/lidar_2/scan_filtered
	/odom
	/relayboard_v2/battery_state
	/relayboard_v2/emergency_stop_state
	/relayboard_v2/state
	/rosout
	/rosout_agg
	/tf
	/tf_static

Visualize the data with RViz
----------------------------
A pre-configured visualization can be started via a launch file from your Client-PC as follows:

AwCombo
**************

::

	ros2 launch awcombo_bringup rviz.launch.py


Teleoperation
-------------

Joystick node is already initialized in the bringup. The Logitech joystick should be operable at this point.

You can use the left stick for movement in X and Y direction and the right stick for rotating. Please make sure to set the joystick to D-mode (found on the top) before teleop.

|joy| 

.. |joy| image:: joystick1.jpg
   :width: 50%

.. |rviz| image:: mpo_700_rviz_basic.png
   :width: 100%